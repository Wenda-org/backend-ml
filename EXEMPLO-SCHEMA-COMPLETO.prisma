// ============================================
// EXEMPLO DE SCHEMA.PRISMA COMPLETO
// ============================================
// Este é um exemplo de como seu schema.prisma deve ficar
// no backend CRUD após adicionar as tabelas do ML

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ============================================
// TABELAS COMPARTILHADAS (já existentes)
// ============================================

model User {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String    @db.VarChar(100)
  email           String    @unique @db.VarChar(120)
  passwordHash    String?   @map("password_hash") @db.VarChar(255)
  role            String    @default("tourist") @db.VarChar(32)
  country         String?   @db.VarChar(80)
  
  // Campos adicionais do mobile (se tiver)
  avatarUrl       String?   @map("avatar_url") @db.VarChar(255)
  phone           String?   @db.VarChar(20)
  bio             String?   @db.Text
  googleId        String?   @unique @map("google_id") @db.VarChar(255)
  appleId         String?   @unique @map("apple_id") @db.VarChar(255)
  isActive        Boolean   @default(true) @map("is_active")
  emailVerifiedAt DateTime? @map("email_verified_at")
  
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime? @updatedAt @map("updated_at")
  deletedAt       DateTime? @map("deleted_at")
  
  // Relacionamentos
  reviews         Review[]
  favorites       Favorite[]
  trips           Trip[]
  userPreferences UserPreferences?
  passwordResets  PasswordReset[]
  recommendations RecommendationsLog[]  // ⬅️ ADICIONAR ESTE
  
  @@map("users")
}

model Destination {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String    @db.VarChar(150)
  slug            String?   @unique @db.VarChar(200)
  province        String?   @db.VarChar(100)
  location        String?   @db.VarChar(200)
  address         String?   @db.VarChar(255)
  description     String?   @db.Text
  longDescription String?   @map("long_description") @db.Text
  
  latitude        Float?    @db.DoublePrecision
  longitude       Float?    @db.DoublePrecision
  
  category        String?   @db.VarChar(50)
  categoryId      String?   @map("category_id") @db.Uuid
  
  rating          Float?    @default(0) @db.DoublePrecision
  ratingAvg       Float?    @map("rating_avg") @db.DoublePrecision
  reviewCount     Int?      @default(0) @map("review_count")
  viewCount       Int?      @default(0) @map("view_count")
  
  openingHours    String?   @map("opening_hours") @db.VarChar(255)
  ticketPrice     String?   @map("ticket_price") @db.VarChar(100)
  phone           String?   @db.VarChar(20)
  email           String?   @db.VarChar(120)
  website         String?   @db.VarChar(255)
  
  amenities       Json?     @db.JsonB
  accessibility   Json?     @db.JsonB
  images          Json?     @db.JsonB
  
  isFeatured      Boolean   @default(false) @map("is_featured")
  isActive        Boolean   @default(true) @map("is_active")
  
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime? @updatedAt @map("updated_at")
  deletedAt       DateTime? @map("deleted_at")
  
  // Relacionamentos
  categoryRel        Category?           @relation(fields: [categoryId], references: [id])
  images2            DestinationImage[]
  reviews            Review[]
  favorites          Favorite[]
  tripDestinations   TripDestination[]
  recommendations    RecommendationsLog[]  // ⬅️ ADICIONAR ESTE
  
  @@map("destinations")
}

// ============================================
// OUTRAS TABELAS DO MOBILE (se tiver)
// ============================================

model Category {
  id           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String        @db.VarChar(100)
  slug         String        @unique @db.VarChar(100)
  description  String?       @db.Text
  icon         String?       @db.VarChar(100)
  displayOrder Int           @default(0) @map("display_order")
  createdAt    DateTime      @default(now()) @map("created_at")
  destinations Destination[]
  
  @@map("categories")
}

model Review {
  id            String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId        String         @map("user_id") @db.Uuid
  destinationId String         @map("destination_id") @db.Uuid
  rating        Int
  comment       String?        @db.Text
  isVerified    Boolean        @default(false) @map("is_verified")
  helpfulCount  Int            @default(0) @map("helpful_count")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime?      @updatedAt @map("updated_at")
  
  user          User           @relation(fields: [userId], references: [id])
  destination   Destination    @relation(fields: [destinationId], references: [id])
  images        ReviewImage[]
  helpful       ReviewHelpful[]
  
  @@unique([userId, destinationId])
  @@map("reviews")
}

model Favorite {
  id            String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId        String      @map("user_id") @db.Uuid
  destinationId String      @map("destination_id") @db.Uuid
  createdAt     DateTime    @default(now()) @map("created_at")
  
  user          User        @relation(fields: [userId], references: [id])
  destination   Destination @relation(fields: [destinationId], references: [id])
  
  @@unique([userId, destinationId])
  @@map("favorites")
}

model Trip {
  id          String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId      String            @map("user_id") @db.Uuid
  name        String            @db.VarChar(200)
  startDate   DateTime          @map("start_date") @db.Date
  endDate     DateTime          @map("end_date") @db.Date
  notes       String?           @db.Text
  status      String            @default("upcoming") @db.VarChar(20)
  createdAt   DateTime          @default(now()) @map("created_at")
  updatedAt   DateTime?         @updatedAt @map("updated_at")
  
  user        User              @relation(fields: [userId], references: [id])
  destinations TripDestination[]
  
  @@map("trips")
}

model TripDestination {
  id            String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tripId        String      @map("trip_id") @db.Uuid
  destinationId String      @map("destination_id") @db.Uuid
  displayOrder  Int         @default(0) @map("display_order")
  visitDate     DateTime?   @map("visit_date") @db.Date
  notes         String?     @db.Text
  createdAt     DateTime    @default(now()) @map("created_at")
  
  trip          Trip        @relation(fields: [tripId], references: [id])
  destination   Destination @relation(fields: [destinationId], references: [id])
  
  @@unique([tripId, destinationId])
  @@map("trip_destinations")
}

// ... outros models do mobile ...

// ============================================
// TABELAS ESPECÍFICAS DO ML (ADICIONAR ESTAS)
// ============================================

model TourismStatistics {
  id                Int      @id @default(autoincrement())
  province          String   @db.VarChar(100)
  month             Int
  year              Int
  domesticVisitors  Int?     @map("domestic_visitors")
  foreignVisitors   Int?     @map("foreign_visitors")
  occupancyRate     Float?   @map("occupancy_rate") @db.DoublePrecision
  avgStayDays       Float?   @map("avg_stay_days") @db.DoublePrecision
  createdAt         DateTime @default(now()) @map("created_at")

  @@map("tourism_statistics")
}

model MLModelsRegistry {
  id          Int       @id @default(autoincrement())
  modelName   String    @map("model_name") @db.VarChar(100)
  version     String    @db.VarChar(20)
  algorithm   String?   @db.VarChar(100)
  metrics     Json?     @db.JsonB
  status      String    @default("active") @db.VarChar(20)
  trainedOn   DateTime? @map("trained_on") @db.Date
  lastUpdated DateTime  @default(now()) @map("last_updated")

  @@map("ml_models_registry")
}

model MLPredictions {
  id                  Int      @id @default(autoincrement())
  modelName           String   @map("model_name") @db.VarChar(100)
  modelVersion        String?  @map("model_version") @db.VarChar(20)
  province            String   @db.VarChar(100)
  month               Int
  year                Int
  predictedVisitors   Int?     @map("predicted_visitors")
  confidenceInterval  Json?    @map("confidence_interval") @db.JsonB
  createdAt           DateTime @default(now()) @map("created_at")

  @@map("ml_predictions")
}

model RecommendationsLog {
  id            Int      @id @default(autoincrement())
  userId        String?  @map("user_id") @db.Uuid
  destinationId String?  @map("destination_id") @db.Uuid
  score         Float?   @db.DoublePrecision
  modelVersion  String?  @map("model_version") @db.VarChar(20)
  createdAt     DateTime @default(now()) @map("created_at")

  user        User?        @relation(fields: [userId], references: [id])
  destination Destination? @relation(fields: [destinationId], references: [id])

  @@map("recommendations_log")
}

// ... outros models necessários ...
